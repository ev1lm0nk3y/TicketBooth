- form_action_name = action_name == 'edit' ? :update : :create
= form_for @ticket_request,
           url: { controller: :ticket_requests, action: form_action_name } do |f|
  = render 'shared/form_errors', resource: @ticket_request

  = f.hidden_field :event_id, value: @event.id

  - if @user
    %h3 Ticket Request for #{@user.name}
  - else
    = f.fields_for :user, @ticket_request.user || User.new do |ff|
      %p
        Already requested a ticket?
        = link_to 'Sign in', new_user_session_path
      = ff.label :name, 'Full Name'
      = ff.text_field :name, class: 'input-xlarge',
        maxlength: User::MAX_NAME_LENGTH, required: true,
        placeholder: 'First and last name'

      = ff.label :email do
        Email
        = help_mark help_text_for(:email)
      = ff.email_field :email, class: 'input-xlarge',
        maxlength: User::MAX_EMAIL_LENGTH, required: true,
        placeholder: 'email@example.com'

      = ff.label :password, 'Password'
      = ff.password_field :password,
        placeholder: 'Must be at least 5 characters', required: true,
        maxlength: User::MAX_PASSWORD_LENGTH, class: 'input-xlarge'

      = ff.label :password_confirmation, 'Confirm Password'
      = ff.password_field :password_confirmation, placeholder: '',
        maxlength: User::MAX_PASSWORD_LENGTH, required: true, class: 'input-xlarge'

  %fieldset
    %p
      How are you contributing to the campout?
      %br
      = f.label :role_volunteer, class: 'radio inline' do
        = f.radio_button :role, TicketRequest::ROLE_VOLUNTEER,
          data: { 'max-tickets' => TicketRequest::TICKET_LIMITS[TicketRequest::ROLE_VOLUNTEER] }
        Working Shifts
      = f.label :role_contributor, class: 'radio inline' do
        = f.radio_button :role, TicketRequest::ROLE_CONTRIBUTOR,
          data: { 'max-tickets' => TicketRequest::TICKET_LIMITS[TicketRequest::ROLE_CONTRIBUTOR] }
        Major Contributor
      = f.label :role_coordinator, class: 'radio inline' do
        = f.radio_button :role, TicketRequest::ROLE_COORDINATOR,
          data: { 'max-tickets' => TicketRequest::TICKET_LIMITS[TicketRequest::ROLE_COORDINATOR] }
        Coordinator
      = f.label :role_uber_coordinator, class: 'radio inline' do
        = f.radio_button :role, TicketRequest::ROLE_UBER_COORDINATOR,
          data: { 'max-tickets' => TicketRequest::TICKET_LIMITS[TicketRequest::ROLE_UBER_COORDINATOR] }
        Uber Coordinator
      = f.label :role_other, class: 'radio inline' do
        = f.radio_button :role, TicketRequest::ROLE_OTHER,
          data: { 'max-tickets' => TicketRequest::TICKET_LIMITS[TicketRequest::ROLE_OTHER] }
        Other
    = f.text_area :role_explanation, class: 'input-xlarge hidden',
      placeholder: 'Briefly describe your role',
      rows: 2, maxlength: 200, required: false
    %p.muted.role-explanation{ class: TicketRequest::ROLE_VOLUNTEER }
      I plan to help out by working one or more shifts at the event
    %p.muted.role-explanation.hidden{ class: TicketRequest::ROLE_CONTRIBUTOR }
      I am bringing gear, driving trucks, leading the cooking of a meal, etc.
    %p.muted.role-explanation.hidden{ class: TicketRequest::ROLE_COORDINATOR }
      I am listed on the coordinator sheet
    %p.muted.role-explanation.hidden{ class: TicketRequest::ROLE_UBER_COORDINATOR }
      I have done a lot of work both off-season and in-season to make this event happen

  - if signed_in? && @event.admin?(current_user)
    .well
      = f.label :special_price, 'Special Ticket Price ($)'
      %p.text-error
        Editable by event admins only. Leave blank to use default price.
      = f.number_field :special_price, class: 'input-small', min: 0

  = f.label :adults, 'Number of tickets'
  = f.number_field :adults, class: 'input-mini', min: 1,
    max: TicketRequest::TICKET_LIMITS[TicketRequest::ROLE_VOLUNTEER],
    data: { default_price: @event.adult_ticket_price.to_i }
  %span.help-inline.inline-price

  - if @event.kid_ticket_price
    = f.label :kids do
      Number of children you are bringing with you (not transferable to adults; babes in arms are free)
      = help_mark help_text_for(:kids)
    = f.number_field :kids, class: 'input-mini', min: 0,
      max: @event.max_kid_tickets_per_request,
      data: { default_price: @event.kid_ticket_price.to_i,
              custom_prices: price_rules_to_json(@event) }
    %span.help-inline.inline-price
    %p.help-inline-block.muted
      Please include the ages of the children (including infants) you are
      bringing with you in the notes below.

  - if @event.cabin_price
    = f.label :cabins do
      How many cabins did you want?
      = help_mark help_text_for(:cabins)
    = f.number_field :cabins, class: 'input-mini', min: 0,
      max: @event.max_cabins_per_request,
      data: { default_price: @event.cabin_price.to_i },
      disabled: !@event.cabins_available?
    %span.help-inline.inline-price
      - unless @event.cabins_available?
        Sorry, we are sold out of cabins at this point in time.

  - if @event.ask_how_many_shifts
    = f.label :volunteer_shifts do
      Approximately how many volunteer shifts are you and your guests likely to sign up for?
      = help_mark help_text_for(:volunteer_shifts)
    = f.number_field :volunteer_shifts, class: 'input-mini', min: 0, required: true

  - if @event.require_mailing_address
    = f.label :address do
      Mailing Address
      = help_mark help_text_for(:address)
    = f.text_area :address, class: 'input-xlarge',
      rows: 3, maxlength: 150, required: true

  = f.label :vehicle_camping_requested, class: 'checkbox' do
    = f.check_box :vehicle_camping_requested
    I’m requesting a car or RV camping spot

  - if @event.allow_financial_assistance
    = f.label :needs_assistance, class: 'checkbox' do
      = f.check_box :needs_assistance
      I’m requesting financial assistance with purchasing my ticket(s)
      = help_mark help_text_for(:needs_assistance)

  = f.label :notes do
    Any special requests or things you want to mention?
    = help_mark help_text_for(:notes)
  = f.text_area :notes, class: 'input-xxlarge',
    rows: 3, maxlength: 500

  .actions
    = f.submit class: 'btn btn-primary btn-large',
               data: { disable_with: 'Creating request...' }
