- form_action_name = action_name == 'edit' ? :update : :create
= form_for @ticket_request,
           url: { controller: :ticket_requests, action: form_action_name } do |f|
  = render 'shared/form_errors', resource: @ticket_request

  = f.hidden_field :event_id, value: @event.id

  - if @user
    %h3 Ticket Request for #{@user.name}
    = f.hidden_field :user_id, value: @user.id
  - else
    %p
      Already requested a ticket?
      = link_to 'Sign in', new_user_session_path
    = label_tag :name, 'Full Name'
    = text_field_tag :name, nil, class: 'input-xlarge',
      maxlength: User::MAX_NAME_LENGTH, required: true,
      placeholder: 'First and last name'

    = label_tag :email do
      Email
      = help_mark help_text_for(:email)
    = email_field_tag :email, nil, class: 'input-xlarge',
      maxlength: User::MAX_EMAIL_LENGTH, required: true,
      placeholder: 'email@example.com'

    = label_tag :password, 'Password'
    = password_field_tag :password, nil,
      placeholder: 'Must be at least 5 characters', required: true,
      maxlength: User::MAX_PASSWORD_LENGTH, class: 'input-xlarge'

    = label_tag :password_confirmation, 'Confirm Password'
    = password_field_tag :password_confirmation, nil, placeholder: '',
      maxlength: User::MAX_PASSWORD_LENGTH, required: true, class: 'input-xlarge'

  - if signed_in? && @event.admin?(current_user)
    .well
      = f.label :special_price, 'Special Ticket Price ($)'
      %p.text-error
        Editable by event admins only. Leave blank to use default price.
      = f.number_field :special_price, class: 'input-small', min: 0

  = f.label :adults, 'Number of adults in your group (including you)'
  = f.number_field :adults, class: 'input-mini', min: 1,
    max: @event.max_adult_tickets_per_request,
    data: { default_price: @event.adult_ticket_price.to_i }
  %span.help-inline.inline-price

  - if @event.kid_ticket_price
    = f.label :kids do
      Number of children you are bringing with you (not transferable to adults; babes in arms are free)
      = help_mark help_text_for(:kids)
    = f.number_field :kids, class: 'input-mini', min: 0,
      max: @event.max_kid_tickets_per_request,
      data: { default_price: @event.kid_ticket_price.to_i,
              custom_prices: price_rules_to_json(@event) }
    %span.help-inline.inline-price
    %p.help-inline-block.muted
      Please include the ages of the children (including infants) you are
      bringing with you in the notes below.

  - if @event.cabin_price
    = f.label :cabins do
      How many cabins did you want?
      = help_mark help_text_for(:cabins)
    = f.number_field :cabins, class: 'input-mini', min: 0,
      max: @event.max_cabins_per_request,
      data: { default_price: @event.cabin_price.to_i },
      disabled: !@event.cabins_available?
    %span.help-inline.inline-price
      - unless @event.cabins_available?
        Sorry, we are sold out of cabins at this point in time.

  = f.label :volunteer_shifts do
    Approximately how many volunteer shifts are you and your guests likely to sign up for?
    = help_mark help_text_for(:volunteer_shifts)
  = f.number_field :volunteer_shifts, class: 'input-mini', min: 0, required: true

  - if @event.require_mailing_address
    = f.label :address do
      Mailing Address
      = help_mark help_text_for(:address)
    = f.text_area :address, class: 'input-xlarge',
      rows: 3, maxlength: 150, required: true

  = f.label :needs_assistance, class: 'checkbox' do
    = f.check_box :needs_assistance
    I need financial assistance to purchase my ticket
    = help_mark help_text_for(:needs_assistance)

  = f.label :performer, class: 'checkbox' do
    = f.check_box :performer
    I've been asked to perform for this event (DJ, lighting, etc.)
    = help_mark help_text_for(:performer)

  = f.label :notes do
    Any special requests or things you want to mention?
    = help_mark help_text_for(:notes)
  = f.text_area :notes, class: 'input-xxlarge',
    rows: 3, maxlength: 500

  .actions
    = f.submit class: 'btn btn-primary btn-large', disable_with: 'Creating request...'
